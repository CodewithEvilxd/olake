# MySQL Driver

The **MySQL Driver** enables data synchronization from MySQL to any supported destination. It supports both **Full Refresh** and **CDC (Change Data Capture)** modes.

## Supported Modes

| Mode                          | Description                                                   |
| ----------------------------- | ------------------------------------------------------------- |
| **Full Refresh**              | Fetches the complete dataset from MySQL.                      |
| **CDC (Change Data Capture)** | Tracks and syncs incremental changes from MySQL in real time. |

---

## Setup & Configuration

Create three JSON config files in your project directory:

| File                   | Purpose                                                   |
| ---------------------- | --------------------------------------------------------- |
| **`source.json`**      | MySQL connection details                                  |
| **`streams.json`**     | List of tables & fields to sync (generated by _Discover_) |
| **`destination.json`** | Destination writer configuration                          |

### Config File (`source.json`)

Add MySQL credentials in the following format (see the [docs](https://olake.io/docs/connectors/mysql/config) for details):

```json
{
  "hosts": "mysql-host",
  "username": "mysql-user",
  "password": "mysql-password",
  "database": "mysql-database",
  "port": 3306,
  "update_method": {
    "intial_wait_time": 10
  },
  "tls_skip_verify": true,
  "default_mode": "cdc",
  "max_threads": 10,
  "backoff_retry_count": 2
}
```

---

## Commands

### Discover Command

Generates JSON content for `streams.json`, defining the schema of the tables to be synced.

```bash
./build.sh driver-mysql discover \
  --config /mysql/config/source.json
```

### Configure Catalog

Before running _Sync_, adjust the generated `streams.json`:

1. **Remove unnecessary streams** from `selected_streams`.
2. **Add partitions** by editing `partition_regex`. Refer the partitioning docs for [AWS S3](https://olake.io/docs/writers/s3/partitioning) and [Apache Iceberg](https://olake.io/docs/writers/iceberg/partitioning) here.
3. **Set sync properties** for every stream you wish to sync:

   ```json
   "sync_mode": "cdc",
   "cursor_field": "<cursor field from available_cursor_fields>"
   ```

**Final catalog example**

```json
{
  "selected_streams": {
    "public": [
      {
        "partition_regex": "",
        "stream_name": "table_1",
         "normalization": false
      }
    ]
  },
  "streams": [
    {
      "stream": {
        "name": "table_1",
        "namespace": "public",
        "type_schema": {
            "properties": {
               "...":"...",
            }
          },
        "supported_sync_modes": ["full_refresh", "cdc"],
        "source_defined_primary_key": [<selected_primary_key>],
        "available_cursor_fields": [<cursor_field>],
        "sync_mode": "cdc"
      }
    }
  ]
}
```

---

### Writer File

For a detailed writer overview, see the [Destinations & Catalog docs](https://olake.io/docs/writers/iceberg/catalog/overview).

---

### Sync Command

Run a sync without state:

```bash
./build.sh driver-mysql sync \
  --config /mysql/configs/source.json \
  --catalog /mysql/configs/streams.json \
  --destination /mysql/configs/destination.json
```

Resume a sync from a saved state:

```bash
./build.sh driver-mysql sync \
  --config /mysql/configs/source.json \
  --catalog /mysql/configs/streams.json \
  --destination /mysql/configs/destination.json \
  --state /mysql/configs/state.json
```

---

## State File

`state.json` lets you resume a sync from the last processed checkpoint:

```json
{
  "type": "GLOBAL",
  "global": {
    "server_id": 7000,
    "state": {
      "position": {
        "Name": "mysql-bin.000040",
        "Pos": 7688
      }
    },
    "streams": ["mydatabase.table_1", "mydatabase.table_2"]
  },
  "streams": [
    {
      "stream": "table_1",
      "namespace": "mydatabase",
      "sync_mode": "",
      "state": {
        "chunks": []
      }
    },
    {
      "stream": "table_2",
      "namespace": "mydatabase",
      "sync_mode": "",
      "state": {
        "chunks": []
      }
    }
  ]
}
```

---

## Additional Resources

- [MySQL Connector Docs](https://olake.io/docs/connectors/mysql/overview)
